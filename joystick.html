<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Joystick Control</title>
    <style>
      body {
        margin: 0;
        background: #111;
        color: white;
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      canvas {
        border: 2px solid #444;
        border-radius: 50%;
        background: #222;
      }
      #slider {
        margin-top: 20px;
        width: 200px;
        height: 20px;
        background: #333;
        position: relative;
      }
      #sliderFill {
        height: 100%;
        background: #0af;
        width: 50%;
      }
    </style>
  </head>
  <body>
    <canvas id="joystick" width="200" height="200"></canvas>

    <script>
      const { ipcRenderer } = require("electron");

      const canvas = document.getElementById("joystick");
      const ctx = canvas.getContext("2d");
      const radius = canvas.width / 2;
      let x = 0,
        z = 0;

      function drawJoystick() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
        ctx.arc(radius, radius, radius - 2, 0, Math.PI * 2);
        ctx.strokeStyle = "#888";
        ctx.stroke();

        ctx.beginPath();
        ctx.arc(radius + x * radius, radius + z * radius, 10, 0, Math.PI * 2);
        ctx.fillStyle = "#0af";
        ctx.fill();
      }

      canvas.addEventListener("mousemove", (e) => {
        const rect = canvas.getBoundingClientRect();
        const dx = e.clientX - rect.left - radius;
        const dz = e.clientY - rect.top - radius;
        const dist = Math.sqrt(dx * dx + dz * dz);
        if (dist < radius) {
          x = dx / radius;
          z = dz / radius;
          sendVector();
        }
      });

      canvas.addEventListener("mouseleave", () => {
        x = 0;
        z = 0;
        sendVector();
      });

      function sendVector() {
        const vec = { x, z };
        console.log("[joystick.html] Sending vectorCommand:", vec);
        ipcRenderer.send("vectorCommand", vec);
        drawJoystick();
      }

      // Removed Y slider and arrow key controls

      drawJoystick();

      // Send current vector every 100ms
      setInterval(() => {
        const vec = { x, z };
        console.log("[joystick.html] Sending vectorCommand (interval):", vec);
        ipcRenderer.send("vectorCommand", vec);
      }, 100);
    </script>
  </body>
</html>
